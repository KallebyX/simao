{"ast":null,"code":"var _jsxFileName = \"/workspaces/simao/whaticket/frontend/src/pages/Chat/ChatPopover.js\";\nimport React, { useContext, useEffect, useReducer, useRef, useState } from \"react\";\nimport { makeStyles } from \"@material-ui/core/styles\";\nimport toastError from \"../../errors/toastError\";\nimport Popover from \"@material-ui/core/Popover\";\nimport ForumIcon from \"@material-ui/icons/Forum\";\nimport { Badge, IconButton, List, ListItem, ListItemText, Paper, Typography } from \"@material-ui/core\";\nimport api from \"../../services/api\";\nimport { isArray } from \"lodash\";\n// import { SocketContext } from \"../../context/Socket/SocketContext\";\nimport { useDate } from \"../../hooks/useDate\";\nimport { AuthContext } from \"../../context/Auth/AuthContext\";\nimport notifySound from \"../../assets/chat_notify.mp3\";\nimport useSound from \"use-sound\";\nimport { i18n } from \"../../translate/i18n\";\nconst useStyles = makeStyles(theme => ({\n  mainPaper: {\n    flex: 1,\n    maxHeight: 300,\n    maxWidth: 500,\n    padding: theme.spacing(1),\n    overflowY: \"scroll\",\n    ...theme.scrollbarStyles\n  }\n}));\nconst reducer = (state, action) => {\n  if (action.type === \"LOAD_CHATS\") {\n    const chats = action.payload;\n    const newChats = [];\n    if (isArray(chats)) {\n      chats.forEach(chat => {\n        const chatIndex = state.findIndex(u => u.id === chat.id);\n        if (chatIndex !== -1) {\n          state[chatIndex] = chat;\n        } else {\n          newChats.push(chat);\n        }\n      });\n    }\n    return [...state, ...newChats];\n  }\n  if (action.type === \"UPDATE_CHATS\") {\n    const chat = action.payload;\n    const chatIndex = state.findIndex(u => u.id === chat.id);\n    if (chatIndex !== -1) {\n      state[chatIndex] = chat;\n      return [...state];\n    } else {\n      return [chat, ...state];\n    }\n  }\n  if (action.type === \"DELETE_CHAT\") {\n    const chatId = action.payload;\n    const chatIndex = state.findIndex(u => u.id === chatId);\n    if (chatIndex !== -1) {\n      state.splice(chatIndex, 1);\n    }\n    return [...state];\n  }\n  if (action.type === \"RESET\") {\n    return [];\n  }\n  if (action.type === \"CHANGE_CHAT\") {\n    const changedChats = state.map(chat => {\n      if (chat.id === action.payload.chat.id) {\n        return action.payload.chat;\n      }\n      return chat;\n    });\n    return changedChats;\n  }\n};\nexport default function ChatPopover() {\n  const classes = useStyles();\n\n  //   const socketManager = useContext(SocketContext);\n  const {\n    user,\n    socket\n  } = useContext(AuthContext);\n  const [loading, setLoading] = useState(false);\n  const [anchorEl, setAnchorEl] = useState(null);\n  const [pageNumber, setPageNumber] = useState(1);\n  const [hasMore, setHasMore] = useState(false);\n  const [searchParam] = useState(\"\");\n  const [chats, dispatch] = useReducer(reducer, []);\n  const [invisible, setInvisible] = useState(true);\n  const {\n    datetimeToClient\n  } = useDate();\n  const [play] = useSound(notifySound);\n  const soundAlertRef = useRef();\n  useEffect(() => {\n    soundAlertRef.current = play;\n    if (!(\"Notification\" in window)) {\n      console.log(\"This browser doesn't support notifications\");\n    } else {\n      Notification.requestPermission();\n    }\n  }, [play]);\n  useEffect(() => {\n    dispatch({\n      type: \"RESET\"\n    });\n    setPageNumber(1);\n  }, [searchParam]);\n  useEffect(() => {\n    setLoading(true);\n    const delayDebounceFn = setTimeout(() => {\n      fetchChats();\n    }, 500);\n    return () => clearTimeout(delayDebounceFn);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [searchParam, pageNumber]);\n  useEffect(() => {\n    if (user.companyId) {\n      const companyId = user.companyId;\n      //    const socket = socketManager.GetSocket();\n\n      const onCompanyChatPopover = data => {\n        if (data.action === \"new-message\") {\n          dispatch({\n            type: \"CHANGE_CHAT\",\n            payload: data\n          });\n          if (data.newMessage.senderId !== user.id) {\n            soundAlertRef.current();\n          }\n        }\n        if (data.action === \"update\") {\n          dispatch({\n            type: \"CHANGE_CHAT\",\n            payload: data\n          });\n        }\n      };\n      socket.on(`company-${companyId}-chat`, onCompanyChatPopover);\n      return () => {\n        socket.off(`company-${companyId}-chat`, onCompanyChatPopover);\n      };\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [user]);\n  useEffect(() => {\n    let unreadsCount = 0;\n    if (chats.length > 0) {\n      for (let chat of chats) {\n        for (let chatUser of chat.users) {\n          if (chatUser.userId === user.id) {\n            unreadsCount += chatUser.unreads;\n          }\n        }\n      }\n    }\n    if (unreadsCount > 0) {\n      setInvisible(false);\n    } else {\n      setInvisible(true);\n    }\n  }, [chats, user.id]);\n  const fetchChats = async () => {\n    try {\n      const {\n        data\n      } = await api.get(\"/chats/\", {\n        params: {\n          searchParam,\n          pageNumber\n        }\n      });\n      dispatch({\n        type: \"LOAD_CHATS\",\n        payload: data.records\n      });\n      setHasMore(data.hasMore);\n      setLoading(false);\n    } catch (err) {\n      toastError(err);\n    }\n  };\n  const loadMore = () => {\n    setPageNumber(prevState => prevState + 1);\n  };\n  const handleScroll = e => {\n    if (!hasMore || loading) return;\n    const {\n      scrollTop,\n      scrollHeight,\n      clientHeight\n    } = e.currentTarget;\n    if (scrollHeight - (scrollTop + 100) < clientHeight) {\n      loadMore();\n    }\n  };\n  const handleClick = event => {\n    setAnchorEl(event.currentTarget);\n    setInvisible(true);\n  };\n  const handleClose = () => {\n    setAnchorEl(null);\n  };\n  const goToMessages = chat => {\n    window.location.href = `/chats/${chat.uuid}`;\n  };\n  const open = Boolean(anchorEl);\n  const id = open ? \"simple-popover\" : undefined;\n  return /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 229,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(IconButton, {\n    \"aria-describedby\": id,\n    variant: \"contained\",\n    color: invisible ? \"default\" : \"inherit\",\n    onClick: handleClick,\n    style: {\n      color: \"white\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 230,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(Badge, {\n    color: \"secondary\",\n    variant: \"dot\",\n    invisible: invisible,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 237,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(ForumIcon, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 238,\n      columnNumber: 11\n    }\n  }))), /*#__PURE__*/React.createElement(Popover, {\n    id: id,\n    open: open,\n    anchorEl: anchorEl,\n    onClose: handleClose,\n    anchorOrigin: {\n      vertical: \"bottom\",\n      horizontal: \"center\"\n    },\n    transformOrigin: {\n      vertical: \"top\",\n      horizontal: \"center\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 241,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(Paper, {\n    variant: \"outlined\",\n    onScroll: handleScroll,\n    className: classes.mainPaper,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 255,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(List, {\n    component: \"nav\",\n    \"aria-label\": \"main mailbox folders\",\n    style: {\n      minWidth: 300\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 260,\n      columnNumber: 11\n    }\n  }, isArray(chats) && chats.map((item, key) => /*#__PURE__*/React.createElement(ListItem, {\n    key: key,\n    style: {\n      background: key % 2 === 0 ? \"#ededed\" : \"white\",\n      border: \"1px solid #eee\",\n      cursor: \"pointer\"\n    },\n    onClick: () => goToMessages(item),\n    button: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 267,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(ListItemText, {\n    primary: item.lastMessage,\n    secondary: /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(Typography, {\n      component: \"span\",\n      style: {\n        fontSize: 12\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 281,\n        columnNumber: 25\n      }\n    }, datetimeToClient(item.updatedAt)), /*#__PURE__*/React.createElement(\"span\", {\n      style: {\n        marginTop: 5,\n        display: \"block\"\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 284,\n        columnNumber: 25\n      }\n    })),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 277,\n      columnNumber: 19\n    }\n  }))), isArray(chats) && chats.length === 0 && /*#__PURE__*/React.createElement(ListItemText, {\n    primary: i18n.t(\"mainDrawer.appBar.notRegister\"),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 291,\n      columnNumber: 15\n    }\n  })))));\n}","map":{"version":3,"names":["React","useContext","useEffect","useReducer","useRef","useState","makeStyles","toastError","Popover","ForumIcon","Badge","IconButton","List","ListItem","ListItemText","Paper","Typography","api","isArray","useDate","AuthContext","notifySound","useSound","i18n","useStyles","theme","mainPaper","flex","maxHeight","maxWidth","padding","spacing","overflowY","scrollbarStyles","reducer","state","action","type","chats","payload","newChats","forEach","chat","chatIndex","findIndex","u","id","push","chatId","splice","changedChats","map","ChatPopover","classes","user","socket","loading","setLoading","anchorEl","setAnchorEl","pageNumber","setPageNumber","hasMore","setHasMore","searchParam","dispatch","invisible","setInvisible","datetimeToClient","play","soundAlertRef","current","window","console","log","Notification","requestPermission","delayDebounceFn","setTimeout","fetchChats","clearTimeout","companyId","onCompanyChatPopover","data","newMessage","senderId","on","off","unreadsCount","length","chatUser","users","userId","unreads","get","params","records","err","loadMore","prevState","handleScroll","e","scrollTop","scrollHeight","clientHeight","currentTarget","handleClick","event","handleClose","goToMessages","location","href","uuid","open","Boolean","undefined","createElement","__self","__source","fileName","_jsxFileName","lineNumber","columnNumber","variant","color","onClick","style","onClose","anchorOrigin","vertical","horizontal","transformOrigin","onScroll","className","component","minWidth","item","key","background","border","cursor","button","primary","lastMessage","secondary","Fragment","fontSize","updatedAt","marginTop","display","t"],"sources":["/workspaces/simao/whaticket/frontend/src/pages/Chat/ChatPopover.js"],"sourcesContent":["import React, {\n  useContext,\n  useEffect,\n  useReducer,\n  useRef,\n  useState,\n} from \"react\";\nimport { makeStyles } from \"@material-ui/core/styles\";\nimport toastError from \"../../errors/toastError\";\nimport Popover from \"@material-ui/core/Popover\";\nimport ForumIcon from \"@material-ui/icons/Forum\";\nimport {\n  Badge,\n  IconButton,\n  List,\n  ListItem,\n  ListItemText,\n  Paper,\n  Typography,\n} from \"@material-ui/core\";\nimport api from \"../../services/api\";\nimport { isArray } from \"lodash\";\n// import { SocketContext } from \"../../context/Socket/SocketContext\";\nimport { useDate } from \"../../hooks/useDate\";\nimport { AuthContext } from \"../../context/Auth/AuthContext\";\n\nimport notifySound from \"../../assets/chat_notify.mp3\";\nimport useSound from \"use-sound\";\nimport { i18n } from \"../../translate/i18n\";\n\nconst useStyles = makeStyles((theme) => ({\n  mainPaper: {\n    flex: 1,\n    maxHeight: 300,\n    maxWidth: 500,\n    padding: theme.spacing(1),\n    overflowY: \"scroll\",\n    ...theme.scrollbarStyles,\n  },\n}));\n\nconst reducer = (state, action) => {\n  if (action.type === \"LOAD_CHATS\") {\n    const chats = action.payload;\n    const newChats = [];\n\n    if (isArray(chats)) {\n      chats.forEach((chat) => {\n        const chatIndex = state.findIndex((u) => u.id === chat.id);\n        if (chatIndex !== -1) {\n          state[chatIndex] = chat;\n        } else {\n          newChats.push(chat);\n        }\n      });\n    }\n\n    return [...state, ...newChats];\n  }\n\n  if (action.type === \"UPDATE_CHATS\") {\n    const chat = action.payload;\n    const chatIndex = state.findIndex((u) => u.id === chat.id);\n\n    if (chatIndex !== -1) {\n      state[chatIndex] = chat;\n      return [...state];\n    } else {\n      return [chat, ...state];\n    }\n  }\n\n  if (action.type === \"DELETE_CHAT\") {\n    const chatId = action.payload;\n\n    const chatIndex = state.findIndex((u) => u.id === chatId);\n    if (chatIndex !== -1) {\n      state.splice(chatIndex, 1);\n    }\n    return [...state];\n  }\n\n  if (action.type === \"RESET\") {\n    return [];\n  }\n\n  if (action.type === \"CHANGE_CHAT\") {\n    const changedChats = state.map((chat) => {\n      if (chat.id === action.payload.chat.id) {\n        return action.payload.chat;\n      }\n      return chat;\n    });\n    return changedChats;\n  }\n};\n\nexport default function ChatPopover() {\n  const classes = useStyles();\n\n//   const socketManager = useContext(SocketContext);\n  const { user, socket } = useContext(AuthContext);\n\n\n  const [loading, setLoading] = useState(false);\n  const [anchorEl, setAnchorEl] = useState(null);\n  const [pageNumber, setPageNumber] = useState(1);\n  const [hasMore, setHasMore] = useState(false);\n  const [searchParam] = useState(\"\");\n  const [chats, dispatch] = useReducer(reducer, []);\n  const [invisible, setInvisible] = useState(true);\n  const { datetimeToClient } = useDate();\n  const [play] = useSound(notifySound);\n  const soundAlertRef = useRef();\n\n  useEffect(() => {\n    soundAlertRef.current = play;\n\n    if (!(\"Notification\" in window)) {\n      console.log(\"This browser doesn't support notifications\");\n    } else {\n      Notification.requestPermission();\n    }\n  }, [play]);\n\n  useEffect(() => {\n    dispatch({ type: \"RESET\" });\n    setPageNumber(1);\n  }, [searchParam]);\n\n  useEffect(() => {\n    setLoading(true);\n    const delayDebounceFn = setTimeout(() => {\n      fetchChats();\n    }, 500);\n    return () => clearTimeout(delayDebounceFn);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [searchParam, pageNumber]);\n\n  useEffect(() => {\n    if (user.companyId) {\n\n      const companyId = user.companyId;\n//    const socket = socketManager.GetSocket();\n\n      const onCompanyChatPopover = (data) => {\n        if (data.action === \"new-message\") {\n          dispatch({ type: \"CHANGE_CHAT\", payload: data });\n          if (data.newMessage.senderId !== user.id) {\n\n            soundAlertRef.current();\n          }\n        }\n        if (data.action === \"update\") {\n          dispatch({ type: \"CHANGE_CHAT\", payload: data });\n        }\n      }\n\n      socket.on(`company-${companyId}-chat`, onCompanyChatPopover);\n\n      return () => {\n        socket.off(`company-${companyId}-chat`, onCompanyChatPopover);\n      };\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [user]);\n\n\n  useEffect(() => {\n    let unreadsCount = 0;\n    if (chats.length > 0) {\n      for (let chat of chats) {\n        for (let chatUser of chat.users) {\n          if (chatUser.userId === user.id) {\n            unreadsCount += chatUser.unreads;\n          }\n        }\n      }\n    }\n    if (unreadsCount > 0) {\n      setInvisible(false);\n    } else {\n      setInvisible(true);\n    }\n  }, [chats, user.id]);\n\n  const fetchChats = async () => {\n    try {\n      const { data } = await api.get(\"/chats/\", {\n        params: { searchParam, pageNumber },\n      });\n      dispatch({ type: \"LOAD_CHATS\", payload: data.records });\n      setHasMore(data.hasMore);\n      setLoading(false);\n    } catch (err) {\n      toastError(err);\n    }\n  };\n\n  const loadMore = () => {\n    setPageNumber((prevState) => prevState + 1);\n  };\n\n  const handleScroll = (e) => {\n    if (!hasMore || loading) return;\n    const { scrollTop, scrollHeight, clientHeight } = e.currentTarget;\n    if (scrollHeight - (scrollTop + 100) < clientHeight) {\n      loadMore();\n    }\n  };\n\n  const handleClick = (event) => {\n    setAnchorEl(event.currentTarget);\n    setInvisible(true);\n  };\n\n  const handleClose = () => {\n    setAnchorEl(null);\n  };\n\n  const goToMessages = (chat) => {\n    window.location.href = `/chats/${chat.uuid}`;\n  };\n\n  const open = Boolean(anchorEl);\n  const id = open ? \"simple-popover\" : undefined;\n\n  return (\n    <div>\n      <IconButton\n        aria-describedby={id}\n        variant=\"contained\"\n        color={invisible ? \"default\" : \"inherit\"}\n        onClick={handleClick}\n        style={{ color: \"white\" }}\n      >\n        <Badge color=\"secondary\" variant=\"dot\" invisible={invisible}>\n          <ForumIcon />\n        </Badge>\n      </IconButton>\n      <Popover\n        id={id}\n        open={open}\n        anchorEl={anchorEl}\n        onClose={handleClose}\n        anchorOrigin={{\n          vertical: \"bottom\",\n          horizontal: \"center\",\n        }}\n        transformOrigin={{\n          vertical: \"top\",\n          horizontal: \"center\",\n        }}\n      >\n        <Paper\n          variant=\"outlined\"\n          onScroll={handleScroll}\n          className={classes.mainPaper}\n        >\n          <List\n            component=\"nav\"\n            aria-label=\"main mailbox folders\"\n            style={{ minWidth: 300 }}\n          >\n            {isArray(chats) &&\n              chats.map((item, key) => (\n                <ListItem\n                  key={key}\n                  style={{\n                    background: key % 2 === 0 ? \"#ededed\" : \"white\",\n                    border: \"1px solid #eee\",\n                    cursor: \"pointer\",\n                  }}\n                  onClick={() => goToMessages(item)}\n                  button\n                >\n                  <ListItemText\n                    primary={item.lastMessage}\n                    secondary={\n                      <>\n                        <Typography component=\"span\" style={{ fontSize: 12 }}>\n                          {datetimeToClient(item.updatedAt)}\n                        </Typography>\n                        <span style={{ marginTop: 5, display: \"block\" }}></span>\n                      </>\n                    }\n                  />\n                </ListItem>\n              ))}\n            {isArray(chats) && chats.length === 0 && (\n              <ListItemText primary={i18n.t(\"mainDrawer.appBar.notRegister\")} />\n            )}\n          </List>\n        </Paper>\n      </Popover>\n    </div>\n  );\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}